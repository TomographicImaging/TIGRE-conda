{% set git_describe_number = environ.get('GIT_DESCRIBE_NUMBER', 0) %}
{% set incremented_build_number = git_describe_number | int + 1 %}

package:
  name: tigre
  version: {{ environ.get('GIT_DESCRIBE_TAG','v')[1:] }}

source:
  git_url: https://github.com/CERN/TIGRE.git
  git_rev: v2.6
  git_depth: 1
  patches:
    - setup.patch
    - cuda_home.patch

build:
  preserve_egg_dir: False
  number: {{ incremented_build_number }}

  missing_dso_whitelist:
    - $RPATH/libc.so.6  # [linux]
    - $RPATH/libm.so.6  # [linux]
    - $RPATH/libdl.so.2 # [linux]
    - $RPATH/libpthread.so.0 # [linux]
    - $RPATH/librt.so.1 # [linux]
    - $RPATH/libicuuc.so.60  #[linux]
    - $RPATH/libicui18n.so.60 #[linux]
    - $RPATH/libcudart.so.* #[linux]

requirements:
  build:
    - python
    - numpy {{ numpy }}
    - setuptools
    - cython
    - ripgrep
    - matplotlib-base
    - scipy
    - tqdm

  run:
    - python
    - {{ pin_compatible('numpy', min_pin='x.x', max_pin='x.x') }}
    - matplotlib-base
    - scipy
    - tqdm
    - libstdcxx-ng # [unix]
    - libgcc-ng # [unix]
    - cudatoolkit {{ cuda_compiler_version }} 
    - vc 14.2 # [win]

about:
  home: https://github.com/CERN/TIGRE
  license:  BSD license
  summary: 'TIGRE: Tomographic Iterative GPU-based Reconstruction Toolbox'
